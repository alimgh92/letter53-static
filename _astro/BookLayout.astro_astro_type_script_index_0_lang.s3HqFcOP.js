"serviceWorker"in navigator&&window.addEventListener("load",async()=>{try{const e=await navigator.serviceWorker.register("/sw.js");e.addEventListener("updatefound",()=>{const n=e.installing;n&&n.addEventListener("statechange",()=>{n.state==="installed"&&navigator.serviceWorker.controller})})}catch{}});const P=document.getElementById("search-shortcut"),D=document.getElementById("ai-shortcut"),q=navigator.platform.toUpperCase().indexOf("MAC")>=0||navigator.userAgent.toUpperCase().indexOf("MAC")>=0;P&&(P.innerHTML=q?'<span dir="ltr">âŒ˜K</span>':'<span dir="ltr">Ctrl+K</span>');D&&(D.innerHTML=q?'<span dir="ltr">âŒ˜â‡§K</span>':'<span dir="ltr">Ctrl+Shift+K</span>');const J=document.getElementById("theme-toggle"),A=["light","dark","sepia"];let $=0;J?.addEventListener("click",()=>{$=($+1)%A.length,document.documentElement.setAttribute("data-theme",A[$]),localStorage.setItem("theme",A[$])});const O=localStorage.getItem("theme");O&&document.documentElement.setAttribute("data-theme",O);const Y=document.getElementById("font-size");let S=18;Y?.addEventListener("click",()=>{S=S>=24?16:S+2,document.documentElement.style.setProperty("--font-size-base",S+"px"),localStorage.setItem("fontSize",S.toString())});const G=document.getElementById("menu-toggle"),b=document.getElementById("sidebar"),M=document.getElementById("sidebar-overlay");function X(){b?.classList.add("active"),M?.classList.add("active"),document.body.style.overflow="hidden"}function H(){b?.classList.remove("active"),M?.classList.remove("active"),document.body.style.overflow=""}G?.addEventListener("click",()=>{b?.classList.contains("active")?H():X()});M?.addEventListener("click",H);document.addEventListener("keydown",e=>{e.key==="Escape"&&(v?.classList.contains("active")?_():b?.classList.contains("active")&&H()),(e.ctrlKey||e.metaKey)&&e.shiftKey&&(e.key==="K"||e.key==="k")&&(e.preventDefault(),z())});const Q=document.getElementById("ai-chat-btn"),v=document.getElementById("ai-chat-modal"),V=document.getElementById("ai-chat-close"),Z=document.getElementById("ai-chat-clear"),c=document.getElementById("ai-chat-input"),I=document.getElementById("ai-chat-send"),h=document.getElementById("ai-chat-messages"),K=document.getElementById("ai-chat-status");let R=0;const ee=20,U="letter53-ai-chat-history";let p=[],g=-1,N="";const x={proxyUrl:window.location.hostname==="localhost"?"http://localhost:8080/proxy":"/api/proxy",apiKey:"",directUrl:""};function te(){if(!h)return;const e=[];h.querySelectorAll(".user-message, .ai-message").forEach(s=>{const a=s.classList.contains("user-message"),l=s.getAttribute("data-raw-content")||s.querySelector(".user-message-content, .ai-message-content")?.textContent||"";l&&l.trim()&&e.push({isUser:a,content:l})}),e.length>0&&localStorage.setItem(U,JSON.stringify(e))}function ne(){if(!h)return;const e=localStorage.getItem(U);if(e)try{const n=JSON.parse(e);p=n.filter(s=>s.isUser).map(s=>s.content),n.forEach(s=>{L(s.content,s.isUser)})}catch(n){console.error("Failed to load chat history:",n),B()}else B()}function B(){L("Ø³Ù„Ø§Ù…! Ù…Ù† Ø¯Ø³ØªÛŒØ§Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù†Ø§Ù…Ù‡ ÛµÛ³ Ù‡Ø³ØªÙ…. Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù… Ø¨Ù‡ Ø´Ù…Ø§ Ø¯Ø± Ø¯Ø±Ú© Ù…Ø·Ø§Ù„Ø¨ Ú©Ù…Ú© Ú©Ù†Ù…. Ø³ÙˆØ§Ù„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù¾Ø±Ø³ÛŒØ¯.",!1)}function se(){h&&(h.innerHTML=""),localStorage.removeItem(U),B()}async function z(){v?.classList.add("active"),v?.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden",setTimeout(()=>c?.focus(),150),await W(),h&&h.children.length===0&&ne()}function _(){v?.classList.remove("active"),v?.setAttribute("aria-hidden","true"),document.body.style.overflow=""}let f=[];async function W(){try{const n=await(await fetch("/api/search-index.json")).json();n&&n.documents&&(f=n.documents)}catch(e){console.error("Failed to load chapters data:",e)}}function ae(e){if(!f||f.length===0)return e;const n={Ø§ÙˆÙ„:"1",Ø¯ÙˆÙ…:"2",Ø³ÙˆÙ…:"3",Ú†Ù‡Ø§Ø±Ù…:"4",Ù¾Ù†Ø¬Ù…:"5",Ø´Ø´Ù…:"6",Ù‡ÙØªÙ…:"7",Ù‡Ø´ØªÙ…:"8",Ù†Ù‡Ù…:"9",Ø¯Ù‡Ù…:"10",ÛŒÚ©:"1",Ø¯Ùˆ:"2",Ø³Ù‡:"3",Ú†Ù‡Ø§Ø±:"4",Ù¾Ù†Ø¬:"5",Ø´Ø´:"6",Ù‡ÙØª:"7",Ù‡Ø´Øª:"8",Ù†Ù‡:"9",Ø¯Ù‡:"10"},s={Ø§ÙˆÙ„ÛŒÙ†:"1",Ø¯ÙˆÙ…ÛŒÙ†:"2",Ø³ÙˆÙ…ÛŒÙ†:"3",Ú†Ù‡Ø§Ø±Ù…ÛŒÙ†:"4",Ù¾Ù†Ø¬Ù…ÛŒÙ†:"5",Ø´Ø´Ù…ÛŒÙ†:"6",Ù‡ÙØªÙ…ÛŒÙ†:"7",Ù‡Ø´ØªÙ…ÛŒÙ†:"8",Ù†Ù‡Ù…ÛŒÙ†:"9",Ø¯Ù‡Ù…ÛŒÙ†:"10"},a=[],l=/(Ø¬Ù„Ø³Ù‡|Ø¬Ù„Ø³Ø§Øª|ÙØµÙ„|Ø¨Ø®Ø´)\s*(Ø§ÙˆÙ„|Ø¯ÙˆÙ…|Ø³ÙˆÙ…|Ú†Ù‡Ø§Ø±Ù…|Ù¾Ù†Ø¬Ù…|Ø´Ø´Ù…|Ù‡ÙØªÙ…|Ù‡Ø´ØªÙ…|Ù†Ù‡Ù…|Ø¯Ù‡Ù…|ÛŒÚ©|Ø¯Ùˆ|Ø³Ù‡|Ú†Ù‡Ø§Ø±|Ù¾Ù†Ø¬|Ø´Ø´|Ù‡ÙØª|Ù‡Ø´Øª|Ù†Ù‡|Ø¯Ù‡|[\dÛ°-Û¹]+)/gi;let t;for(;(t=l.exec(e))!==null;){const i=t[2],u=i.replace(/[Û°-Û¹]/g,o=>"Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹".indexOf(o).toString()),m=n[i]||u,r=f.find(o=>o.slug===`chapter-${m}`||o.chapter==m);r&&a.push({start:t.index,end:t.index+t[0].length,text:t[0],replacement:`<a href="/chapters/${r.slug}" class="chapter-link">${t[0]}</a>`})}const w=/Ø¬Ù„Ø³Ø§Øª?\s*(Ø§ÙˆÙ„|Ø¯ÙˆÙ…|Ø³ÙˆÙ…|Ú†Ù‡Ø§Ø±Ù…|Ù¾Ù†Ø¬Ù…|Ø´Ø´Ù…|Ù‡ÙØªÙ…|Ù‡Ø´ØªÙ…|Ù†Ù‡Ù…|Ø¯Ù‡Ù…|ÛŒÚ©|Ø¯Ùˆ|Ø³Ù‡|Ú†Ù‡Ø§Ø±|Ù¾Ù†Ø¬|Ø´Ø´|Ù‡ÙØª|Ù‡Ø´Øª|Ù†Ù‡|Ø¯Ù‡|[\dÛ°-Û¹]+)/gi;for(;(t=w.exec(e))!==null;){const i=t[1],u=i.replace(/[Û°-Û¹]/g,o=>"Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹".indexOf(o).toString()),m=n[i]||u,r=f.find(o=>o.slug===`chapter-${m}`||o.chapter==m);r&&(a.some(d=>t.index>=d.start&&t.index<d.end||t.index+t[0].length>d.start&&t.index+t[0].length<=d.end)||a.push({start:t.index,end:t.index+t[0].length,text:t[0],replacement:`<a href="/chapters/${r.slug}" class="chapter-link">${t[0]}</a>`}))}const y=/Ùˆ\s*([\dÛ°-Û¹]+)/gi;for(;(t=y.exec(e))!==null;){const i=t[1],m=i.replace(/[Û°-Û¹]/g,o=>"Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹".indexOf(o).toString()),r=f.find(o=>o.slug===`chapter-${m}`||o.chapter==m);r&&(a.some(d=>t.index>=d.start&&t.index<d.end||t.index+t[0].length>d.start&&t.index+t[0].length<=d.end)||a.push({start:t.index,end:t.index+t[0].length,text:t[0],replacement:`Ùˆ <a href="/chapters/${r.slug}" class="chapter-link">${i}</a>`}))}const E=/ØŒ\s*([\dÛ°-Û¹]+|Ø§ÙˆÙ„|Ø¯ÙˆÙ…|Ø³ÙˆÙ…|Ú†Ù‡Ø§Ø±Ù…|Ù¾Ù†Ø¬Ù…|Ø´Ø´Ù…|Ù‡ÙØªÙ…|Ù‡Ø´ØªÙ…|Ù†Ù‡Ù…|Ø¯Ù‡Ù…|ÛŒÚ©|Ø¯Ùˆ|Ø³Ù‡|Ú†Ù‡Ø§Ø±|Ù¾Ù†Ø¬|Ø´Ø´|Ù‡ÙØª|Ù‡Ø´Øª|Ù†Ù‡|Ø¯Ù‡)/gi;for(;(t=E.exec(e))!==null;){const i=t[1],u=i.replace(/[Û°-Û¹]/g,o=>"Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹".indexOf(o).toString()),m=n[i]||u,r=f.find(o=>o.slug===`chapter-${m}`||o.chapter==m);r&&(a.some(d=>t.index>=d.start&&t.index<d.end||t.index+t[0].length>d.start&&t.index+t[0].length<=d.end)||a.push({start:t.index,end:t.index+t[0].length,text:t[0],replacement:`ØŒ <a href="/chapters/${r.slug}" class="chapter-link">${i}</a>`}))}const T=/(Ø§ÙˆÙ„ÛŒÙ†|Ø¯ÙˆÙ…ÛŒÙ†|Ø³ÙˆÙ…ÛŒÙ†|Ú†Ù‡Ø§Ø±Ù…ÛŒÙ†|Ù¾Ù†Ø¬Ù…ÛŒÙ†|Ø´Ø´Ù…ÛŒÙ†|Ù‡ÙØªÙ…ÛŒÙ†|Ù‡Ø´ØªÙ…ÛŒÙ†|Ù†Ù‡Ù…ÛŒÙ†|Ø¯Ù‡Ù…ÛŒÙ†)\s+ÙØµÙ„/gi;for(;(t=T.exec(e))!==null;){const i=t[1],u=s[i],m=f.find(r=>r.slug===`chapter-${u}`||r.chapter==u);m&&(a.some(o=>t.index>=o.start&&t.index<o.end||t.index+t[0].length>o.start&&t.index+t[0].length<=o.end)||a.push({start:t.index,end:t.index+t[0].length,text:t[0],replacement:`<a href="/chapters/${m.slug}" class="chapter-link">${t[0]}</a>`}))}a.sort((i,u)=>u.start-i.start);let k=e;for(const i of a)k=k.substring(0,i.start)+i.replacement+k.substring(i.end);return k}function oe(e){return e=e.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>"),e=e.replace(/__([^_]+)__/g,"<strong>$1</strong>"),e=e.replace(/(?<!\*)\*(?!\*)([^*]+)(?<!\*)\*(?!\*)/g,"<em>$1</em>"),e=e.replace(/(?<!_)_(?!_)([^_]+)(?<!_)_(?!_)/g,"<em>$1</em>"),e=e.replace(/\n\n/g,"</p><p>"),e=e.replace(/\n/g,"<br>"),e.startsWith("<p>")||(e="<p>"+e+"</p>"),e=e.replace(/^- (.+)$/gm,"<li>$1</li>"),e=e.replace(/(<li>.*<\/li>)/s,"<ul>$1</ul>"),e=e.replace(/^\d+\. (.+)$/gm,"<li>$1</li>"),e}function L(e,n=!1){if(!h)return;const s=document.createElement("div");s.className=n?"user-message":"ai-message";const a=document.createElement("div");a.className=n?"user-message-avatar":"ai-message-avatar",a.textContent=n?"ðŸ‘¨":"âœ¨";const l=document.createElement("div");if(l.className=n?"user-message-content":"ai-message-content",s.setAttribute("data-raw-content",e),n)l.textContent=e;else{const t=oe(e),w=ae(t);l.innerHTML=w}s.appendChild(a),s.appendChild(l),h.appendChild(s),h.scrollTop=h.scrollHeight,te()}function C(e){K&&(K.textContent=e)}function re(){if(!h)return;const e=document.createElement("div");e.className="thinking-indicator",e.id="thinking-indicator";const n=document.createElement("div");n.className="thinking-avatar",n.textContent="âœ¨";const s=document.createElement("div");s.className="thinking-content";const a=document.createElement("div");a.className="typing-dots";for(let l=0;l<3;l++){const t=document.createElement("span");t.className="typing-dot",a.appendChild(t)}s.appendChild(a),e.appendChild(n),e.appendChild(s),h.appendChild(e),h.scrollTop=h.scrollHeight}function j(){const e=document.getElementById("thinking-indicator");e&&e.remove()}async function F(e){if(R>=ee){C("Ø¯Ø³ØªÛŒØ§Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù…ÙˆÙ‚ØªØ§Ù‹ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª. Ù„Ø·ÙØ§Ù‹ Ø§Ø² Ø¬Ø³ØªØ¬ÙˆÛŒ Ø³Ø§Ø¯Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.");return}L(e,!0),p.push(e),g=p.length,c&&(c.value=""),I&&I.setAttribute("disabled","true"),re(),C("");try{const s=await(await fetch(`/api/search-index.json?t=${Date.now()}`)).json();let a="",l=0;s&&s.documents&&(l=s.documents.length,a=`Ù…Ø­ØªÙˆØ§ÛŒ Ú©Ø§Ù…Ù„ Ú©ØªØ§Ø¨:

`,s.documents.forEach(r=>{a+=`===== Ø¬Ù„Ø³Ù‡ ${r.chapter}: ${r.title} =====
`,a+=`${r.content}

`})),R++;const t=x.proxyUrl&&x.proxyUrl.length>0,w=t?x.proxyUrl:x.directUrl,y={"Content-Type":"application/json"};t||(y.Authorization=`Bearer ${x.apiKey}`,y["HTTP-Referer"]=window.location.origin,y["X-Title"]="Letter53 Book");const E=[];E.push({role:"system",content:`Ø´Ù…Ø§ Ø¯Ø³ØªÛŒØ§Ø± Ú©ØªØ§Ø¨ "Ù†Ø§Ù…Ù‡ ÛµÛ³" Ù‡Ø³ØªÛŒØ¯. 

${l<46?`ØªÙˆØ¬Ù‡ Ù…Ù‡Ù…: Ø§Ø² Ú©Ù„ Ú©ØªØ§Ø¨ (Û´Û¶ Ø¬Ù„Ø³Ù‡)ØŒ ØªØ§Ú©Ù†ÙˆÙ† ${l.toString().replace(/\d/g,r=>"Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹"[r])} ÙØµÙ„ Ù…Ù†ØªØ´Ø± Ø´Ø¯Ù‡ Ø§Ø³Øª. 
Ø¯Ø± Ø§Ø¨ØªØ¯Ø§ÛŒ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒØªØ§Ù† Ø®ÛŒÙ„ÛŒ Ú©ÙˆØªØ§Ù‡ Ø§Ø´Ø§Ø±Ù‡ Ú©Ù†ÛŒØ¯: "âš ï¸ Ø§ÛŒÙ† Ù¾Ø§Ø³Ø® Ø¨Ø± Ø§Ø³Ø§Ø³ ${l.toString().replace(/\d/g,r=>"Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹"[r])} ÙØµÙ„ Ù…Ù†ØªØ´Ø± Ø´Ø¯Ù‡ Ø§Ø² Û´Û¶ ÙØµÙ„ ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù‡ Ø§Ø³Øª."

`:""}Ù‚ÙˆØ§Ù†ÛŒÙ† Ø¨Ø³ÛŒØ§Ø± Ù…Ù‡Ù…:
1. ÙˆÙ‚ØªÛŒ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø­ØªÙˆØ§ÛŒ Ù†Ø§Ù…Ù‡ ÛµÛ³ ØªÙˆØ¶ÛŒØ­ Ù…ÛŒâ€ŒØ¯Ù‡ÛŒØ¯ØŒ ÙÙ‚Ø· Ø§Ø² Ø§ÛŒÙ† Ú©ØªØ§Ø¨ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
2. Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ§Ù„Ø§Øª Ø¹Ù…ÙˆÙ…ÛŒØŒ Ø§Ø² Ø¯Ø§Ù†Ø´ Ú©Ø§Ù…Ù„ Ø®ÙˆØ¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯ (ØªØ§Ø±ÛŒØ®ØŒ Ø¬ØºØ±Ø§ÙÛŒØ§ØŒ Ø§ÙØ±Ø§Ø¯ Ù…Ø´Ù‡ÙˆØ±ØŒ Ø¹Ù„ÙˆÙ… Ùˆ...)
3. Ø¨Ø±Ø§ÛŒ Ù…Ù‚Ø§ÛŒØ³Ù‡â€ŒÙ‡Ø§ Ùˆ ØªØ­Ù„ÛŒÙ„â€ŒÙ‡Ø§ØŒ Ø¢Ø²Ø§Ø¯Ø§Ù†Ù‡ Ø§Ø² Ø¯Ø§Ù†Ø´ Ø¹Ù…ÙˆÙ…ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
4. Ø§Ú¯Ø± Ø³ÙˆØ§Ù„ÛŒ Ù…Ø³ØªÙ‚ÛŒÙ…Ø§Ù‹ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø­ØªÙˆØ§ÛŒ Ù†Ø§Ù…Ù‡ ÛµÛ³ Ø§Ø³Øª Ùˆ Ø¯Ø± Ú©ØªØ§Ø¨ Ù†ÛŒØ³ØªØŒ Ø¨Ú¯ÙˆÛŒÛŒØ¯: "Ø§ÛŒÙ† Ù…ÙˆØ¶ÙˆØ¹ Ø¯Ø± Ú©ØªØ§Ø¨ Ø¨Ø±Ø±Ø³ÛŒ Ù†Ø´Ø¯Ù‡"
5. Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ Ù¾Ø§Ø³Ø® Ø¯Ù‡ÛŒØ¯
6. Ù‡Ù…ÛŒØ´Ù‡ Ø¯Ø± Ø§Ù†ØªÙ‡Ø§ÛŒ Ù¾Ø§Ø³Ø®ØŒ Ø¨Ù‡ ÙØµÙ„â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ù…Ø­ØªÙˆØ§ Ø§Ø² Ø¢Ù†Ù‡Ø§ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø´Ø¯Ù‡ Ø¨Ù‡ ØµÙˆØ±Øª Ø®Ù„Ø§ØµÙ‡ Ø§Ø´Ø§Ø±Ù‡ Ú©Ù†ÛŒØ¯ (Ù…Ø«Ø§Ù„: ðŸ“š Ù…Ù†Ø¨Ø¹: Ø¬Ù„Ø³Ù‡ Û² Ùˆ Û³)

Ù‚ÙˆØ§Ù†ÛŒÙ† Ù†Ú¯Ø§Ø±Ø´ÛŒ Ø§Ù„Ø²Ø§Ù…ÛŒ:
- Ù‡Ø±Ú¯Ø² Ø§Ø² (Ø¹) ÛŒØ§ (Øµ) ÛŒØ§ (Ø³) Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†Ú©Ù†ÛŒØ¯
- Ø¨Ø±Ø§ÛŒ Ø§Ù…Ø§Ù…Ø§Ù†: Ø¹Ù„ÛŒÙ‡ Ø§Ù„Ø³Ù„Ø§Ù… ÛŒØ§ Ø¹Ù„ÛŒÙ‡Ù… Ø§Ù„Ø³Ù„Ø§Ù…
- Ø¨Ø±Ø§ÛŒ Ù¾ÛŒØ§Ù…Ø¨Ø±: ØµÙ„ÛŒ Ø§Ù„Ù„Ù‡ Ø¹Ù„ÛŒÙ‡ Ùˆ Ø¢Ù„Ù‡
- Ø¨Ø±Ø§ÛŒ Ø­Ø¶Ø±Øª Ø²Ù‡Ø±Ø§: Ø³Ù„Ø§Ù… Ø§Ù„Ù„Ù‡ Ø¹Ù„ÛŒÙ‡Ø§
- Ù‡Ù…ÛŒØ´Ù‡ Ø¹Ø¨Ø§Ø±Ø§Øª Ú©Ø§Ù…Ù„ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯ØŒ Ù†Ù‡ Ù…Ø®ÙÙ
- Ù‡ÛŒÚ†â€ŒÙˆÙ‚Øª Ø§Ø² Ø§Ø¹Ø¯Ø§Ø¯ Ù„Ø§ØªÛŒÙ† (0123456789) Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†Ú©Ù†ÛŒØ¯
- Ù‡Ù…ÛŒØ´Ù‡ Ø§Ø² Ø§Ø±Ù‚Ø§Ù… ÙØ§Ø±Ø³ÛŒ (Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹) Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯

Ù†Ø­ÙˆÙ‡ Ù¾Ø§Ø³Ø®â€ŒØ¯Ù‡ÛŒ:
- Ø¨Ù‡ ØµÙˆØ±Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶ØŒ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ù…Ù„ Ùˆ Ø¨Ø§ Ø¬Ø²Ø¦ÛŒØ§Øª Ø§Ø±Ø§Ø¦Ù‡ Ø¯Ù‡ÛŒØ¯
- Ù†Ú©Ø§Øª Ù…Ù‡Ù… Ø±Ø§ ØªÙˆØ¶ÛŒØ­ Ø¯Ù‡ÛŒØ¯
- Ø§Ø² Ù…Ø«Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ø¯Ø± Ú©ØªØ§Ø¨ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
- Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ú©Ù„Ù…Ø§Øª "Ø®Ù„Ø§ØµÙ‡"ØŒ "Ù…Ø®ØªØµØ±" ÛŒØ§ "Ú©ÙˆØªØ§Ù‡" Ø±Ø§ Ø¨Ù‡ Ú©Ø§Ø± Ø¨Ø±Ø¯ØŒ Ù¾Ø§Ø³Ø® Ú©ÙˆØªØ§Ù‡ Ø¯Ù‡ÛŒØ¯
- Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ø®ÙˆØ§Ø³Øª "Ø¨ÛŒØ´ØªØ± ØªÙˆØ¶ÛŒØ­ Ø¨Ø¯Ù‡" ÛŒØ§ "Ú©Ø§Ù…Ù„â€ŒØªØ±"ØŒ Ø¨Ø§ Ø¬Ø²Ø¦ÛŒØ§Øª Ø¨ÛŒØ´ØªØ± Ù¾Ø§Ø³Ø® Ø¯Ù‡ÛŒØ¯
- Ù‡Ù…ÛŒØ´Ù‡ Ø¨Ù‡ ÙØµÙ„ Ù…Ø±Ø¨ÙˆØ·Ù‡ Ø§Ø´Ø§Ø±Ù‡ Ú©Ù†ÛŒØ¯

${a||"Ù…Ø­ØªÙˆØ§ÛŒ Ú©ØªØ§Ø¨ ÛŒØ§ÙØª Ù†Ø´Ø¯."}`});const T=h?.querySelectorAll(".user-message, .ai-message")||[];Array.from(T).slice(-10).forEach(r=>{const o=r.classList.contains("user-message"),d=r.querySelector(".user-message-content, .ai-message-content")?.textContent;d&&d.trim()&&E.push({role:o?"user":"assistant",content:d.trim()})}),E.push({role:"user",content:e});const i=await fetch(w,{method:"POST",headers:y,body:JSON.stringify({model:"google/gemini-flash-1.5-8b",messages:E})});if(!i.ok)throw new Error(`API Error: ${i.status}`);const m=(await i.json()).choices?.[0]?.message?.content||"Ù…ØªØ£Ø³ÙØ§Ù†Ù‡ Ù¾Ø§Ø³Ø®ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù†Ø´Ø¯.";j(),L(m,!1),C("")}catch(n){console.error("=== AI Chat Error ==="),console.error("Error:",n),console.error("Error Message:",n.message),console.error("API URL:",apiUrl),console.error("Using Proxy:",isUsingProxy),console.error("Time:",new Date().toLocaleString("fa-IR")),console.error("=================="),j();let s="Ù…ØªØ£Ø³ÙØ§Ù†Ù‡ Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯Ù‡ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø§Ø² Ø¬Ø³ØªØ¬ÙˆÛŒ Ø³Ø§Ø¯Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.";n instanceof TypeError&&n.message.includes("fetch")?(s="Ø¹Ø¯Ù… Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø§ÛŒÙ†ØªØ±Ù†Øª. Ù„Ø·ÙØ§Ù‹ Ø§ØªØµØ§Ù„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø§Ø² Ø¬Ø³ØªØ¬ÙˆÛŒ Ø³Ø§Ø¯Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.",C("Ø¹Ø¯Ù… Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø§ÛŒÙ†ØªØ±Ù†Øª"),console.error("Possible cause: Proxy server not running at",apiUrl)):navigator.onLine?(C("Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆÛŒØ³ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ"),console.error("Check if proxy server is running at:",apiUrl)):(s="Ø´Ù…Ø§ Ø¢ÙÙ„Ø§ÛŒÙ† Ù‡Ø³ØªÛŒØ¯. Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø§ØªØµØ§Ù„ Ø§ÛŒÙ†ØªØ±Ù†Øª Ø¯Ø§Ø±ÛŒØ¯. Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² Ø¬Ø³ØªØ¬ÙˆÛŒ Ø³Ø§Ø¯Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.",C("Ø­Ø§Ù„Øª Ø¢ÙÙ„Ø§ÛŒÙ†")),L(s)}finally{I&&I.removeAttribute("disabled")}}W();Q?.addEventListener("click",z);V?.addEventListener("click",_);Z?.addEventListener("click",se);v?.addEventListener("click",e=>{e.target===v&&_()});I?.addEventListener("click",()=>{const e=c?.value.trim();e&&F(e)});c?.addEventListener("input",()=>{g<p.length&&(g=p.length,N=c.value)});c?.addEventListener("keydown",e=>{if(e.key==="Enter"&&!e.shiftKey){e.preventDefault();const n=c.value.trim();n&&F(n)}else e.key==="ArrowUp"&&c.selectionStart===0?(e.preventDefault(),g===p.length&&(N=c.value),g>0&&(g--,c.value=p[g],setTimeout(()=>{c.selectionStart=c.selectionEnd=c.value.length},0))):e.key==="ArrowDown"&&(e.preventDefault(),g<p.length-1?(g++,c.value=p[g]):g===p.length-1&&(g=p.length,c.value=N),setTimeout(()=>{c.selectionStart=c.selectionEnd=c.value.length},0))});window.addEventListener("scroll",()=>{const e=document.body.scrollTop||document.documentElement.scrollTop,n=document.documentElement.scrollHeight-document.documentElement.clientHeight,s=e/n*100,a=document.querySelector(".progress-bar");a&&(a.style.width=s+"%")});
